<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 이벤트 namespace -->
<mapper namespace="event">
	
	<resultMap type="eventModel" id="eventModelRes">
		<result property="event_no" column="event_no" />
		<result property="event_subject" column="event_subject" />
		<result property="event_content" column="event_content" />
		<result property="event_hit" column="event_hit" />
		<result property="event_start_date" column="event_start_date" />
		<result property="event_end_date" column="event_end_date" />
		<result property="event_original_file_name" column="event_original_file_name" />
		<result property="event_stored_file_name" column="event_stored_file_name" />
		<result property="event_category" column="event_category" />
	</resultMap>
	
	<sql id="select-all">
		select * from event
	</sql>
	
	<!-- 페이징 sql -->
	<sql id="pagingHeader">
		select * from (select rownum as rn, a.* from (
	</sql>
	<sql id="pagingFooter">
		)a ) where rn between #{start} and #{end}
	</sql>
	
	<!-- 검색 조건 -->
	<sql id="search">
		<choose>
			<!-- 검색 옵션이 전체 검색일 경우 -->
			<when test="searchOption == 'all'">
				where (event_subject like '%'||#{keyword}||'%' or event_content like '%'||#{keyword}||'%' or event_category like '%'||#{keyword}||'%')
			</when>
			
			<!-- 전체 검색이 아닐 경우 -->
			<otherwise>
				where ${searchOption} like '%'||#{keyword}||'%'
			</otherwise>
		</choose>
	</sql>
	
	<!-- 게시글 목록 조회 및 검색 조회 까지 -->
	<select id="eventListAll" resultMap="eventModelRes">
		<include refid="pagingHeader" />
		select rownum, event_no, event_subject, event_content, event_start_date, event_end_date, event_hit, event_category, event_original_file_name, event_stored_file_name from event
		<include refid="search" />
		order by event_no desc
		<include refid="pagingFooter"></include>
	</select>
	
	<!-- 게시글 레코드 갯수 -->
	<select id="count" resultType="int">
		select count(*) from event
		<!-- where 절을 include 태그로 삽입 -->
		<include refid="search" />
	</select>
	
	<!-- 게시글 작성 -->
	<select id="eventWrite" parameterType="eventModel">
		insert into event (event_no, event_subject, event_content, event_start_date, event_end_date, event_original_file_name, event_stored_file_name, event_category) 
		values (event_no_seq.NEXTVAL, #{event_subject}, #{event_content}, to_date(#{event_start_date}, 'YYYY.MM.DD'), to_date(#{event_end_date}, 'YYYY.MM.DD'), #{event_original_file_name}, #{event_stored_file_name}, #{event_category})
	</select>
	
	<!-- 이벤트 해당 게시글 번호 -->
	<select id="eventGetSEQ" resultType="int">
		select event_no_seq.NEXTVAL from dual
	</select>

</mapper>