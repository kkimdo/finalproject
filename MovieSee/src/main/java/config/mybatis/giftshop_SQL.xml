<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 공지사항 namespace -->
<mapper namespace="giftshop">

	<resultMap type="giftShopProductModel" id="giftShopProductModelRes">
		<result property="giftshop_product_no" column="giftshop_product_no" />
		<result property="giftshop_product_name" column="giftshop_product_name" />
		<result property="giftshop_product_price" column="giftshop_product_price" />
		<result property="giftshop_product_file" column="giftshop_product_file" />
		<result property="giftshop_product_restrictions" column="giftshop_product_restrictions" />
		<result property="giftshop_product_periodofuse" column="giftshop_product_periodofuse" />
		<result property="giftshop_product_desc1" column="giftshop_product_desc1" />
		<result property="giftshop_product_desc2" column="giftshop_product_desc2" />
		<result property="giftshop_product_desc3" column="giftshop_product_desc3" />
		<result property="giftshop_product_date" column="giftshop_product_date" />
	</resultMap>

	<sql id="select-all">
		select * from giftshop_product
	</sql>

	<!-- 페이징 sql -->
	<sql id="pagingHeader">
		select * from (select rownum as rn, a.* from (
	</sql>
	<sql id="pagingFooter">
		)a ) where rn between #{start} and #{end}
	</sql>

	<!-- 검색 조건 -->
	<sql id="search">
		<choose>
			<!-- 검색 옵션이 전체 검색일 경우 -->
			<when test="searchOption == 'all'">
				where (giftshop_product_name like '%'||#{keyword}||'%' or
				giftshop_product_price like '%'||#{keyword}||'%' or 
				giftshop_product_desc1 like '%'||#{keyword}||'%')
			</when>

			<!-- 전체 검색이 아닐 경우 -->
			<otherwise>
				where ${searchOption} like '%'||#{keyword}||'%'
			</otherwise>
		</choose>
	</sql>

	<!-- 상품 등록 -->
	<insert id="gspWrite" parameterType="giftShopProductModel">
		insert into giftshop_product
		(giftshop_product_no, 
		giftshop_product_name, 
		giftshop_product_price, 
		giftshop_product_file, 
		giftshop_product_restrictions,
		giftshop_product_periodofuse,
		giftshop_product_desc1, 
		giftshop_product_desc2, 
		giftshop_product_desc3, 
		giftshop_product_date)
		values 
		(giftshop_product_no_seq.NEXTVAL,
		#{giftshop_product_name},
		#{giftshop_product_price},
		#{giftshop_product_file},
		#{giftshop_product_restrictions},
		#{giftshop_product_periodofuse},
		#{giftshop_product_desc1},
		#{giftshop_product_desc2},
		#{giftshop_product_desc3}, 
		sysdate)
	</insert>

	<select id="gspListProduct" resultMap="giftShopProductModelRes">
		<include refid="pagingHeader" />
		select rownum, giftshop_product_no, giftshop_product_name,
		giftshop_product_price, giftshop_product_file,
		giftshop_product_restrictions, giftshop_product_periodofuse, giftshop_product_desc1,
		giftshop_product_desc2, giftshop_product_desc3, giftshop_product_date
		from giftshop_product
		<include refid="search" />
		order by giftshop_product_no desc, giftshop_product_date desc
		<include refid="pagingFooter"></include>
	</select>

	<select id="count" resultType="int">
		select count(*) from giftshop_product
		<include refid="search" />
	</select>

	<select id="gspGetSEQ" resultType="int">
		select giftshop_product_no_seq.NEXTVAL
		from dual
	</select>


</mapper>
